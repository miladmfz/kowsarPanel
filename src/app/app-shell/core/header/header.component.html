<!-- 🔝 Topbar Start -->
<div class="navbar-custom">
  <div class="container-fluid">
    <ul class="list-unstyled topnav-menu float-end mb-0">

      <!-- 🔔 Notifications -->
      <li class="dropdown notification-list topbar-dropdown">
        <a class="nav-link dropdown-toggle waves-effect waves-light position-relative" data-bs-toggle="dropdown"
          href="#" role="button" aria-haspopup="false" aria-expanded="false">
          <i class="fe-bell noti-icon"></i>
          @if (AlarmActive_Row + AlarmActtive_Conversation + AlarmActtive_LeaveRequest > 0) {
            <span
              class="badge bg-danger rounded-circle noti-icon-badge animate-pulse">
              {{ AlarmActive_Row + AlarmActtive_Conversation + AlarmActtive_LeaveRequest }}
            </span>
          }
        </a>

        <div class="dropdown-menu dropdown-menu-end dropdown-lg shadow-lg border-0 rounded-3">
          <div class="dropdown-header noti-title bg-light text-center fw-bold py-2">
            اعلان‌ها
          </div>

          @if (AlarmActive_Row > 0) {
            <a class="dropdown-item notify-item" [routerLink]="['/support/letter-mywork']">
              <div class="notify-icon bg-info"><i class="fe-briefcase"></i></div>
              <p class="notify-details">
                <span class="text-danger fw-semibold">{{ AlarmActive_Row }}</span> ارجاع جدید دارید
              </p>
            </a>
          }

          @if (AlarmActtive_Conversation > 0) {
            <a class="dropdown-item notify-item" [routerLink]="['/support/letter-mywork']">
              <div class="notify-icon bg-warning"><i class="fe-message-circle"></i></div>
              <p class="notify-details">
                <span class="text-danger fw-semibold">{{ AlarmActtive_Conversation }}</span> پیام جدید دارید
              </p>
            </a>
          }

          @if (AlarmActtive_LeaveRequest > 0) {
            <a class="dropdown-item notify-item" [routerLink]="['/support/leavereq-list']">
              <div class="notify-icon bg-success"><i class="fe-user-check"></i></div>
              <p class="notify-details">
                <span class="text-danger fw-semibold">{{ AlarmActtive_LeaveRequest }}</span> درخواست مرخصی جدید دارید
              </p>
            </a>
          }

          @if (AlarmActive_Row + AlarmActtive_Conversation + AlarmActtive_LeaveRequest === 0) {
            <div
              class="text-center text-muted py-3 small">
              هیچ اعلان جدیدی ندارید
            </div>
          }
        </div>
      </li>


      <!-- 👤 User Profile -->
      <li class="dropdown notification-list topbar-dropdown">
        <a class="nav-link dropdown-toggle nav-user me-0 waves-effect waves-light d-flex align-items-center"
          data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">

          @if (Imageitem && Imageitem.length > 100) {
            <img [src]="Imageitem" alt="user-image"
              class="rounded-circle user-avatar" />
          } @else {
            <img src="./assets/images/KowsarSupport.png" alt="user-image" class="rounded-circle user-avatar" />
          }

          <span class="pro-user-name ms-2 fw-semibold">
            {{ PhFullName || 'کاربر سیستم' }}
            <i class="mdi mdi-chevron-down ms-1"></i>
          </span>
        </a>

        <div class="dropdown-menu dropdown-menu-end profile-dropdown shadow-lg border-0 rounded-3">
          <div class="dropdown-divider my-2"></div>

          <!-- 🌗 Theme Toggle -->
          <div class="theme-switch-wrapper px-3 py-2 d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center gap-2">
              <i class="fe-moon text-secondary"></i>
              <span class="theme-label small">{{ isDarkMode ? 'حالت شب' : 'حالت روز' }}</span>
            </div>
            <label class="theme-switch mb-0">
              <input type="checkbox" id="theme-toggle" (change)="toggleTheme($event)" [checked]="isDarkMode" />
              <span class="slider round"></span>
            </label>
          </div>

          <div class="dropdown-divider my-2"></div>

          <a [routerLink]="['/support/profile']" class="dropdown-item notify-item">
            <i class="fe-user text-primary"></i>
            <span>حساب کاربری</span>
          </a>

          <a (click)="logout()" class="dropdown-item notify-item text-danger">
            <i class="ri-logout-box-line"></i>
            <span>خروج</span>
          </a>
        </div>
      </li>
    </ul>

    <!-- 🏷️ LOGO -->
    <div class="logo-box">
      <a href="/" class="logo logo-dark text-center">
        <span class="logo-sm">
          <img src="./assets/images/logo-sm-dark.png" alt="" height="24" />
        </span>
        <span class="logo-lg">
          <img src="./assets/images/logo-dark.png" alt="" height="20" />
        </span>
      </a>

      <a href="/" class="logo logo-light text-center">
        <span class="logo-sm">
          <img src="./assets/images/logo-sm.png" alt="" height="24" />
        </span>
        <span class="logo-lg">
          <img src="./assets/images/logo-light.png" alt="" height="20" />
        </span>
      </a>
    </div>

    <!-- ☰ Menu -->
    <ul class="list-unstyled topnav-menu topnav-menu-left m-0">
      <li>
        <button class="button-menu-mobile waves-effect waves-light">
          <i class="fe-menu"></i>
        </button>
      </li>
      <li>
        <a class="navbar-toggle nav-link" data-bs-toggle="collapse" data-bs-target="#topnav-menu-content">
          <div class="lines"><span></span><span></span><span></span></div>
        </a>
      </li>
    </ul>

    <div class="clearfix"></div>
  </div>
</div>
<!-- 🔚 End Topbar -->

<!-- 🎨 Custom Styles -->
<style>
  .user-avatar {
  width: 38px;
  height: 38px;
  object-fit: cover;
  border: 2px solid #fff;
  box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
}

.animate-pulse {
animation: pulse 1.5s infinite;
}

@keyframes pulse {
0% {
transform: scale(1);
opacity: 1;
}

50% {
transform: scale(1.2);
opacity: 0.7;
}

100% {
transform: scale(1);
opacity: 1;
}
}

.theme-switch {
position: relative;
display: inline-block;
width: 44px;
height: 22px;
}

.theme-switch input {
display: none;
}

.slider {
position: absolute;
cursor: pointer;
top: 0;
left: 0;
right: 0;
bottom: 0;
background-color: #ccc;
transition: 0.4s;
border-radius: 22px;
}

.slider:before {
position: absolute;
content: "";
height: 16px;
width: 16px;
left: 3px;
bottom: 3px;
background-color: white;
transition: 0.4s;
border-radius: 50%;
}

input:checked+.slider {
background-color: #4d94ff;
}

input:checked+.slider:before {
transform: translateX(22px);
}

/* 🔵 Button styling for status dropdown */
.btn-outline-info {
font-size: 13px;
padding: 4px 10px;
}

.dropdown-menu {
min-width: 140px;
}
</style>